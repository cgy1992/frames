set -e
set -o nounset
set -o pipefail

unzip generate.zip
rm *.zip
lua scripts/build.lua $target $platform $configuration

rm -f bin/$target/$platform/*/*.idb bin/$target/$platform/*/*.lib bin/$target/$platform/*/*.exp bin/$target/$platform/*/*.ilk lib/$target/$platform/*.ilk

# test to fix some permission issues
chmod -R u+rwX,go+rX,go-w .

zip -r test-$target-$platform-$configuration.zip bin/$target/$platform/test
zip -r lib-$target-$platform-$configuration.zip lib/$target/$platform
